<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

 


      <title>Linux网络 - </title>

  <meta name="description" content="摘自 倪朋飞-极客时间-Linux性能优化实战
Linux 通用 IP 网络栈的示意图：
网卡是发送和接收网络包的基本设备。在系统启动过程中，网卡通过内核中的网卡驱动程序注册到系统中。而在网络收发过程中，内核通过中断跟网卡进行交互。再结合前面提到的 Linux 网络栈，可以看出，网络包的处理非常复杂。所以，网卡硬中断只处理最核心的网卡数据读取或发送，而协议栈中的大部分逻辑，都会放到软中断中处理。
网络包的接收流程 当一个网络帧到达网卡后，网卡会通过 DMA 方式，把这个网络包放到收包队列中；然后通过硬中断，告诉中断处理程序已经收到了网络包。
接着，网卡中断处理程序会为网络帧分配内核数据结构（sk_buff），并将其拷贝到sk_buff 缓冲区中；然后再通过软中断，通知内核收到了新的网络帧。
接下来，内核协议栈从缓冲区中取出网络帧，并通过网络协议栈，从下到上逐层处理这个网络帧。比如:
在链路层检查报文的合法性，找出上层协议的类型（比如 IPv4 还是 IPv6），再去掉帧头、帧尾，然后交给网络层。网络层取出 IP 头，判断网络包下一步的走向，比如是交给上层处理还是转发。当网络层确认这个包是要发送到本机后，就会取出上层协议的类型（比如 TCP 还是 UDP），去掉 IP 头，再交给传输层处理。传输层取出 TCP 头或者 UDP 头后，根据 &lt; 源 IP、源端口、目的 IP、目的端口 &gt; 四元组作为标识，找出对应的 Socket，并把数据拷贝到 Socket 的接收缓存中。
最后，应用程序就可以使用 Socket 接口，读取到新接收到的数据了。
网络包的发送流程 网络包的发送流程就是上图的右半部分，很容易发现，网络包的发送方向，正好跟接收方向相反。
首先，应用程序调用 Socket API（比如 sendmsg）发送网络包。在链路层检查报文的合法性，找出上层协议的类型（比如 IPv4 还是 IPv6），再去掉帧头、帧尾，然后交给网络层。网络层取出 IP 头，判断网络包下一步的走向，比如是交给上层处理还是转发。
当网络层确认这个包是要发送到本机后，就会取出上层协议的类型（比如 TCP 还是 UDP），去掉 IP 头，再交给传输层处理。传输层取出 TCP 头或者 UDP 头后，根据 &lt; 源 IP、源端口、目的 IP、目的端口 &gt; 四元组作为标识，找出对应的 Socket，并把数据拷贝到 Socket 的接收缓存中。">
  <meta name="author" content="renhongzhen"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Code Mark",
    
    "url": "https:\/\/hzren.github.io\/blog\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/hzren.github.io\/blog\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/hzren.github.io\/blog\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/hzren.github.io\/blog\/blog\/2021-01-19-linux%E7%BD%91%E7%BB%9C\/",
          "name": "Linux网络"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "renhongzhen"
  },
  "headline": "Linux网络",
  "description" : "摘自 倪朋飞-极客时间-Linux性能优化实战\nLinux 通用 IP 网络栈的示意图：\n网卡是发送和接收网络包的基本设备。在系统启动过程中，网卡通过内核中的网卡驱动程序注册到系统中。而在网络收发过程中，内核通过中断跟网卡进行交互。再结合前面提到的 Linux 网络栈，可以看出，网络包的处理非常复杂。所以，网卡硬中断只处理最核心的网卡数据读取或发送，而协议栈中的大部分逻辑，都会放到软中断中处理。\n网络包的接收流程 当一个网络帧到达网卡后，网卡会通过 DMA 方式，把这个网络包放到收包队列中；然后通过硬中断，告诉中断处理程序已经收到了网络包。\n接着，网卡中断处理程序会为网络帧分配内核数据结构（sk_buff），并将其拷贝到sk_buff 缓冲区中；然后再通过软中断，通知内核收到了新的网络帧。\n接下来，内核协议栈从缓冲区中取出网络帧，并通过网络协议栈，从下到上逐层处理这个网络帧。比如:\n在链路层检查报文的合法性，找出上层协议的类型（比如 IPv4 还是 IPv6），再去掉帧头、帧尾，然后交给网络层。网络层取出 IP 头，判断网络包下一步的走向，比如是交给上层处理还是转发。当网络层确认这个包是要发送到本机后，就会取出上层协议的类型（比如 TCP 还是 UDP），去掉 IP 头，再交给传输层处理。传输层取出 TCP 头或者 UDP 头后，根据 \u0026lt; 源 IP、源端口、目的 IP、目的端口 \u0026gt; 四元组作为标识，找出对应的 Socket，并把数据拷贝到 Socket 的接收缓存中。\n最后，应用程序就可以使用 Socket 接口，读取到新接收到的数据了。\n网络包的发送流程 网络包的发送流程就是上图的右半部分，很容易发现，网络包的发送方向，正好跟接收方向相反。\n首先，应用程序调用 Socket API（比如 sendmsg）发送网络包。在链路层检查报文的合法性，找出上层协议的类型（比如 IPv4 还是 IPv6），再去掉帧头、帧尾，然后交给网络层。网络层取出 IP 头，判断网络包下一步的走向，比如是交给上层处理还是转发。\n当网络层确认这个包是要发送到本机后，就会取出上层协议的类型（比如 TCP 还是 UDP），去掉 IP 头，再交给传输层处理。传输层取出 TCP 头或者 UDP 头后，根据 \u0026lt; 源 IP、源端口、目的 IP、目的端口 \u0026gt; 四元组作为标识，找出对应的 Socket，并把数据拷贝到 Socket 的接收缓存中。",
  "inLanguage" : "zh-cn",
  "wordCount":  1611 ,
  "datePublished" : "2021-01-19T18:30:32",
  "dateModified" : "2021-01-19T18:30:32",
  "image" : "https:\/\/hzren.github.io\/blog\/img\/avatar-icon.png",
  "keywords" : [ "Linux, Network" ],
  "mainEntityOfPage" : "https:\/\/hzren.github.io\/blog\/blog\/2021-01-19-linux%E7%BD%91%E7%BB%9C\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/hzren.github.io\/blog\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/hzren.github.io\/blog\/img\/avatar-icon.png",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="Linux网络" />
<meta property="og:description" content="摘自 倪朋飞-极客时间-Linux性能优化实战
Linux 通用 IP 网络栈的示意图：
网卡是发送和接收网络包的基本设备。在系统启动过程中，网卡通过内核中的网卡驱动程序注册到系统中。而在网络收发过程中，内核通过中断跟网卡进行交互。再结合前面提到的 Linux 网络栈，可以看出，网络包的处理非常复杂。所以，网卡硬中断只处理最核心的网卡数据读取或发送，而协议栈中的大部分逻辑，都会放到软中断中处理。
网络包的接收流程 当一个网络帧到达网卡后，网卡会通过 DMA 方式，把这个网络包放到收包队列中；然后通过硬中断，告诉中断处理程序已经收到了网络包。
接着，网卡中断处理程序会为网络帧分配内核数据结构（sk_buff），并将其拷贝到sk_buff 缓冲区中；然后再通过软中断，通知内核收到了新的网络帧。
接下来，内核协议栈从缓冲区中取出网络帧，并通过网络协议栈，从下到上逐层处理这个网络帧。比如:
在链路层检查报文的合法性，找出上层协议的类型（比如 IPv4 还是 IPv6），再去掉帧头、帧尾，然后交给网络层。网络层取出 IP 头，判断网络包下一步的走向，比如是交给上层处理还是转发。当网络层确认这个包是要发送到本机后，就会取出上层协议的类型（比如 TCP 还是 UDP），去掉 IP 头，再交给传输层处理。传输层取出 TCP 头或者 UDP 头后，根据 &lt; 源 IP、源端口、目的 IP、目的端口 &gt; 四元组作为标识，找出对应的 Socket，并把数据拷贝到 Socket 的接收缓存中。
最后，应用程序就可以使用 Socket 接口，读取到新接收到的数据了。
网络包的发送流程 网络包的发送流程就是上图的右半部分，很容易发现，网络包的发送方向，正好跟接收方向相反。
首先，应用程序调用 Socket API（比如 sendmsg）发送网络包。在链路层检查报文的合法性，找出上层协议的类型（比如 IPv4 还是 IPv6），再去掉帧头、帧尾，然后交给网络层。网络层取出 IP 头，判断网络包下一步的走向，比如是交给上层处理还是转发。
当网络层确认这个包是要发送到本机后，就会取出上层协议的类型（比如 TCP 还是 UDP），去掉 IP 头，再交给传输层处理。传输层取出 TCP 头或者 UDP 头后，根据 &lt; 源 IP、源端口、目的 IP、目的端口 &gt; 四元组作为标识，找出对应的 Socket，并把数据拷贝到 Socket 的接收缓存中。">
<meta property="og:image" content="https://hzren.github.io/blog/img/avatar-icon.png" />
<meta property="og:url" content="https://hzren.github.io/blog/blog/2021-01-19-linux%E7%BD%91%E7%BB%9C/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Code Mark" />

  <meta name="twitter:title" content="Linux网络" />
  <meta name="twitter:description" content="摘自 倪朋飞-极客时间-Linux性能优化实战
Linux 通用 IP 网络栈的示意图：
网卡是发送和接收网络包的基本设备。在系统启动过程中，网卡通过内核中的网卡驱动程序注册到系统中。而在网络收发过程中，内核通过中断跟网卡进行交互。再结合前面提到的 Linux 网络栈，可以看出，网络包的处理非常复杂。所以，网卡硬中断只处理最核心的网卡数据读取或发送，而协议栈中的大部分逻辑，都会放到软中断中处理。
 …">
  <meta name="twitter:image" content="https://hzren.github.io/blog/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@username" />
  <meta name="twitter:creator" content="@username" />
  <link href='https://hzren.github.io/blog/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.109.0">
  <link rel="alternate" href="https://hzren.github.io/blog/index.xml" type="application/rss+xml" title="Code Mark"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://hzren.github.io/blog/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://hzren.github.io/blog/css/highlight.min.css" /><link rel="stylesheet" href="https://hzren.github.io/blog/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">


  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">切换导航</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://hzren.github.io/blog/">Code Mark</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="文章" href="/blog/">文章</a>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent">代码</a>
              <div class="navlinks-children">
                
                  <a href="/blog/post/2017-03-07-bigimg-sample">Big Image Sample</a>
                
                  <a href="/blog/post/2017-03-05-math-sample">Math Sample</a>
                
                  <a href="/blog/post/2016-03-08-code-sample">Code Sample</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="关于我" href="/blog/page/about/">关于我</a>
            </li>
          
        
          
            <li>
              <a title="分类" href="/blog/tags">分类</a>
            </li>
          
        

        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="Code Mark" href="https://hzren.github.io/blog/">
            <img class="avatar-img" src="https://hzren.github.io/blog/img/avatar-icon.png" alt="Code Mark" />
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="blog-heading">
              
                <h1>Linux网络</h1>
              
              
                <hr class="small">
              
              
              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p><strong>摘自 倪朋飞-极客时间-Linux性能优化实战</strong></p>
<p>Linux 通用 IP 网络栈的示意图：</p>
<p><img src="/static/attachment/20210119/linux-net-1.jpg" alt=""></p>
<p>网卡是发送和接收网络包的基本设备。在系统启动过程中，网卡通过内核中的网卡驱动程序注册到系统中。而在网络收发过程中，内核通过中断跟网卡进行交互。再结合前面提到的 Linux 网络栈，可以看出，网络包的处理非常复杂。所以，网卡硬中断只处理最核心的网卡数据读取或发送，而协议栈中的大部分逻辑，都会放到软中断中处理。</p>
<h3 id="网络包的接收流程">网络包的接收流程</h3>
<p>当一个网络帧到达网卡后，网卡会通过 DMA 方式，把这个网络包放到收包队列中；然后通过硬中断，告诉中断处理程序已经收到了网络包。</p>
<p>接着，网卡中断处理程序会为网络帧分配内核数据结构（sk_buff），并将其拷贝到sk_buff 缓冲区中；然后再通过软中断，通知内核收到了新的网络帧。</p>
<p>接下来，内核协议栈从缓冲区中取出网络帧，并通过网络协议栈，从下到上逐层处理这个网络帧。比如:</p>
<blockquote>
<p>在链路层检查报文的合法性，找出上层协议的类型（比如 IPv4 还是 IPv6），再去掉帧头、帧尾，然后交给网络层。网络层取出 IP 头，判断网络包下一步的走向，比如是交给上层处理还是转发。当网络层确认这个包是要发送到本机后，就会取出上层协议的类型（比如 TCP 还是 UDP），去掉 IP 头，再交给传输层处理。传输层取出 TCP 头或者 UDP 头后，根据 &lt; 源 IP、源端口、目的 IP、目的端口 &gt; 四元组作为标识，找出对应的 Socket，并把数据拷贝到 Socket 的接收缓存中。</p>
</blockquote>
<p>最后，应用程序就可以使用 Socket 接口，读取到新接收到的数据了。</p>
<p><img src="/static/attachment/20210119/linux-net-2.jpg" alt=""></p>
<h3 id="网络包的发送流程">网络包的发送流程</h3>
<p>网络包的发送流程就是上图的右半部分，很容易发现，网络包的发送方向，正好跟接收方向相反。</p>
<p>首先，应用程序调用 Socket API（比如 sendmsg）发送网络包。在链路层检查报文的合法性，找出上层协议的类型（比如 IPv4 还是 IPv6），再去掉帧头、帧尾，然后交给网络层。网络层取出 IP 头，判断网络包下一步的走向，比如是交给上层处理还是转发。</p>
<p>当网络层确认这个包是要发送到本机后，就会取出上层协议的类型（比如 TCP 还是 UDP），去掉 IP 头，再交给传输层处理。传输层取出 TCP 头或者 UDP 头后，根据 &lt; 源 IP、源端口、目的 IP、目的端口 &gt; 四元组作为标识，找出对应的 Socket，并把数据拷贝到 Socket 的接收缓存中。</p>
<p>由于这是一个系统调用，所以会陷入到内核态的套接字层中。套接字层会把数据包放到Socket 发送缓冲区中。</p>
<p>接下来，网络协议栈从 Socket 发送缓冲区中，取出数据包；再按照 TCP/IP 栈，从上到下逐层处理。比如，传输层和网络层，分别为其增加 TCP 头和 IP 头，执行路由查找确认下一跳的 IP，并按照 MTU 大小进行分片。分片后的网络包，再送到网络接口层，进行物理地址寻址，以找到下一跳的 MAC 地址。然后添加帧头和帧尾，放到发包队列中。</p>
<p>这一切完成后，会有软中断通知驱动程序：发包队列中有新的网络帧需要发送。最后，驱动程序通过 DMA ，从发包队列中读出网络帧，并通过物理网卡把它发送出去。</p>
<h3 id="性能指标">性能指标</h3>
<p>我们通常用带宽、吞吐量、延时、PPS（Packet Per Second）等指标衡量网络的性能。</p>
<ul>
<li>带宽，表示链路的最大传输速率，单位通常为 b/s （比特 / 秒）。</li>
<li>吞吐量，表示单位时间内成功传输的数据量，单位通常为 b/s（比特 / 秒）或者B/s（字节 / 秒）。吞吐量受带宽限制，而吞吐量 / 带宽，也就是该网络的使用率。</li>
<li>延时，表示从网络请求发出后，一直到收到远端响应，所需要的时间延迟。在不同场景中，这一指标可能会有不同含义。比如，它可以表示，建立连接需要的时间（比如 TCP握手延时），或一个数据包往返所需的时间（比如 RTT）。</li>
<li>PPS，是 Packet Per Second（包 / 秒）的缩写，表示以网络包为单位的传输速率。PPS 通常用来评估网络的转发能力，比如硬件交换机，通常可以达到线性转发（即 PPS可以达到或者接近理论最大值）。而基于 Linux 服务器的转发，则容易受网络包大小的影响。</li>
</ul>
<p>除了这些指标，网络的可用性（网络能否正常通信）、并发连接数（TCP 连接数量）、丢包率（丢包百分比）、重传率（重新传输的网络包比例）等也是常用的性能指标。</p>
<h3 id="网络配置">网络配置</h3>
<p>可以使用 ifconfig 或者 ip命令，来查看网络的配置。我个人更推荐使用 ip 工具，因为它提供了更丰富的功能和更易用的接口。</p>
<blockquote>
<p>ifconfig 和 ip 分别属于软件包 net-tools 和 iproute2，iproute2 是 net-tools 的下一代。通常情况下它们会在发行版中默认安装。但如果你找不到ifconfig 或者 ip 命令，可以安装这两个软件包。</p>
</blockquote>
<p>以网络接口 eth0 为例，可以运行下面的两个命令，查看它的配置和状态：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@testswarm1 ~]# ifconfig ens192
</span></span><span class="line"><span class="cl">ens192: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
</span></span><span class="line"><span class="cl">        inet 10.0.3.88  netmask 255.255.255.0  broadcast 10.0.3.255
</span></span><span class="line"><span class="cl">        inet6 fe80::b876:4d07:ed7d:e86b  prefixlen 64  scopeid 0x20&lt;link&gt;
</span></span><span class="line"><span class="cl">        inet6 fe80::79ca:1267:2268:b41  prefixlen 64  scopeid 0x20&lt;link&gt;
</span></span><span class="line"><span class="cl">        inet6 fe80::e1af:f2de:94d7:f04  prefixlen 64  scopeid 0x20&lt;link&gt;
</span></span><span class="line"><span class="cl">        ether 00:50:56:91:36:31  txqueuelen 1000  (Ethernet)
</span></span><span class="line"><span class="cl">        RX packets 2613732557  bytes 872797801826 (812.8 GiB)
</span></span><span class="line"><span class="cl">        RX errors 1  dropped 835  overruns 0  frame 0
</span></span><span class="line"><span class="cl">        TX packets 2209685587  bytes 785016406343 (731.1 GiB)
</span></span><span class="line"><span class="cl">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@testswarm1 ~]# ip -s addr show dev ens192
</span></span><span class="line"><span class="cl">2: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP qlen 1000
</span></span><span class="line"><span class="cl">    link/ether 00:50:56:91:36:31 brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="cl">    inet 10.0.3.88/24 brd 10.0.3.255 scope global ens192
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">    inet6 fe80::b876:4d07:ed7d:e86b/64 scope link tentative dadfailed 
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">    inet6 fe80::79ca:1267:2268:b41/64 scope link tentative dadfailed 
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">    inet6 fe80::e1af:f2de:94d7:f04/64 scope link tentative dadfailed 
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">    RX: bytes  packets  errors  dropped overrun mcast   
</span></span><span class="line"><span class="cl">    872798435878 2613735342 1       835     0       242     
</span></span><span class="line"><span class="cl">    TX: bytes  packets  errors  dropped carrier collsns 
</span></span><span class="line"><span class="cl">    785017006422 2209687959 0       0       0       00
</span></span></code></pre></div><p>这里有几个跟网络性能密切相关的指标，需要你特别关注一下:</p>
<p>第一，网络接口的状态标志。ifconfig 输出中的 RUNNING ，或 ip 输出中的LOWER_UP ，都表示物理网络是连通的，即网卡已经连接到了交换机或者路由器中。如果你看不到它们，通常表示网线被拔掉了。</p>
<p>第二，MTU 的大小。MTU 默认大小是 1500，根据网络架构的不同（比如是否使用了VXLAN 等叠加网络），你可能需要调大或者调小 MTU 的数值。</p>
<p>第三，网络接口的 IP 地址、子网以及 MAC 地址。这些都是保障网络功能正常工作所必需的，你需要确保配置正确。</p>
<p>第四，网络收发的字节数、包数、错误数以及丢包情况，特别是 TX 和 RX 部分的errors、dropped、overruns、carrier 以及 collisions 等指标不为 0 时，通常表示出现了网络 I/O 问题。其中：</p>
<blockquote>
<ul>
<li>errors 表示发生错误的数据包数，比如校验错误、帧同步错误等；</li>
<li>dropped 表示丢弃的数据包数，即数据包已经收到了 Ring Buffer，但因为内存不足等原因丢包；</li>
<li>overruns 表示超限数据包数，即网络 I/O 速度过快，导致 Ring Buffer 中的数据包来不及处理（队列满）而导致的丢包；</li>
<li>carrier 表示发生 carrirer 错误的数据包数，比如双工模式不匹配、物理电缆出现问题等；</li>
<li>collisions 表示碰撞数据包数。</li>
</ul>
</blockquote>
<h3 id="套接字信息">套接字信息</h3>
<p>fconfig 和 ip 只显示了网络接口收发数据包的统计信息，但在实际的性能问题中，网络协议栈中的统计信息，我们也必须关注。可以用 netstat 或者 ss ，来查看套接字、网络栈、网络接口以及路由表的信息。个人更推荐，使用 ss 来查询网络的连接信息，因为它比 netstat 提供了更好的性能（速度更快）。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># head -n 3 表示只显示前面 3 行
</span></span><span class="line"><span class="cl"># -l 表示只显示监听套接字
</span></span><span class="line"><span class="cl"># -n 表示显示数字地址和端口 (而不是名字)
</span></span><span class="line"><span class="cl"># -p 表示显示进程信息
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@10-7-123-10 ~]# netstat -nlp | head -n 3
</span></span><span class="line"><span class="cl">Active Internet connections (only servers)
</span></span><span class="line"><span class="cl">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
</span></span><span class="line"><span class="cl">tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      1325/master      
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># -l 表示只显示监听套接字
</span></span><span class="line"><span class="cl"># -t 表示只显示 TCP 套接字
</span></span><span class="line"><span class="cl"># -n 表示显示数字地址和端口 (而不是名字)
</span></span><span class="line"><span class="cl"># -p 表示显示进程信息
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@10-7-123-10 ~]# ss -ltnp | head -n 3
</span></span><span class="line"><span class="cl">State      Recv-Q Send-Q Local Address:Port               Peer Address:Port              
</span></span><span class="line"><span class="cl">LISTEN     0      100    127.0.0.1:25                       *:*                   users:((&#34;master&#34;,pid=1325,fd=13))
</span></span><span class="line"><span class="cl">LISTEN     0      128          *:111                      *:*                   users:((&#34;rpcbind&#34;,pid=714,fd=4),(&#34;systemd&#34;,pid=1,fd=39))
</span></span></code></pre></div><p>netstat 和 ss 的输出也是类似的，都展示了套接字的状态、接收队列、发送队列、本地地址、远端地址、进程 PID 和进程名称等。</p>
<p>其中，接收队列（Recv-Q）和发送队列（Send-Q）需要你特别关注，它们通常应该是0。当你发现它们不是 0 时，说明有网络包的堆积发生。当然还要注意，在不同套接字状态下，它们的含义不同。</p>
<p>当套接字处于连接状态（Established）时:</p>
<blockquote>
<p>Recv-Q 表示套接字缓冲还没有被应用程序取走的字节数（即接收队列长度）。而 Send-Q 表示还没有被远端主机确认的字节数（即发送队列长度）。</p>
</blockquote>
<p>当套接字处于监听状态（Listening）时:</p>
<blockquote>
<p>Recv-Q 表示 syn backlog 的当前值。而 Send-Q 表示最大的 syn backlog 值。</p>
</blockquote>
<p>而 syn backlog 是 TCP 协议栈中的半连接队列长度，相应的也有一个全连接队列（accept queue），它们都是维护 TCP 状态的重要机制。</p>
<p>顾名思义，所谓半连接，就是还没有完成 TCP 三次握手的连接，连接只进行了一半，而服务器收到了客户端的 SYN 包后，就会把这个连接放到半连接队列中，然后再向客户端发送SYN+ACK 包。而全连接，则是指服务器收到了客户端的 ACK，完成了 TCP 三次握手，然后就会把这个连接挪到全连接队列中。这些全连接中的套接字，还需要再被 accept() 系统调用取走，这样，服务器就可以开始真正处理客户端的请求了。</p>
<h3 id="协议栈统计信息">协议栈统计信息</h3>
<p>类似的，使用 netstat 或 ss ，也可以查看协议栈的信息：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@10-7-123-10 ~]# netstat -s
</span></span><span class="line"><span class="cl">Ip:
</span></span><span class="line"><span class="cl">    560455 total packets received
</span></span><span class="line"><span class="cl">    0 forwarded
</span></span><span class="line"><span class="cl">    0 incoming packets discarded
</span></span><span class="line"><span class="cl">    560453 incoming packets delivered
</span></span><span class="line"><span class="cl">    649962 requests sent out
</span></span><span class="line"><span class="cl">Icmp:
</span></span><span class="line"><span class="cl">    70 ICMP messages received
</span></span><span class="line"><span class="cl">    0 input ICMP message failed.
</span></span><span class="line"><span class="cl">    ICMP input histogram:
</span></span><span class="line"><span class="cl">        destination unreachable: 6
</span></span><span class="line"><span class="cl">        echo replies: 64
</span></span><span class="line"><span class="cl">    104 ICMP messages sent
</span></span><span class="line"><span class="cl">    0 ICMP messages failed
</span></span><span class="line"><span class="cl">    ICMP output histogram:
</span></span><span class="line"><span class="cl">        destination unreachable: 9
</span></span><span class="line"><span class="cl">        echo request: 95
</span></span><span class="line"><span class="cl">IcmpMsg:
</span></span><span class="line"><span class="cl">        InType0: 64
</span></span><span class="line"><span class="cl">        InType3: 6
</span></span><span class="line"><span class="cl">        OutType3: 9
</span></span><span class="line"><span class="cl">        OutType8: 95
</span></span><span class="line"><span class="cl">Tcp:
</span></span><span class="line"><span class="cl">    914 active connections openings
</span></span><span class="line"><span class="cl">    19435 passive connection openings
</span></span><span class="line"><span class="cl">    202 failed connection attempts
</span></span><span class="line"><span class="cl">    33 connection resets received
</span></span><span class="line"><span class="cl">    3 connections established
</span></span><span class="line"><span class="cl">    559219 segments received
</span></span><span class="line"><span class="cl">    653603 segments send out
</span></span><span class="line"><span class="cl">    43076 segments retransmited
</span></span><span class="line"><span class="cl">    6 bad segments received.
</span></span><span class="line"><span class="cl">    1550 resets sent
</span></span><span class="line"><span class="cl">Udp:
</span></span><span class="line"><span class="cl">    1155 packets received
</span></span><span class="line"><span class="cl">    9 packets to unknown port received.
</span></span><span class="line"><span class="cl">    0 packet receive errors
</span></span><span class="line"><span class="cl">    1166 packets sent
</span></span><span class="line"><span class="cl">    0 receive buffer errors
</span></span><span class="line"><span class="cl">    0 send buffer errors
</span></span><span class="line"><span class="cl">UdpLite:
</span></span><span class="line"><span class="cl">TcpExt:
</span></span><span class="line"><span class="cl">    202 resets received for embryonic SYN_RECV sockets
</span></span><span class="line"><span class="cl">    775 TCP sockets finished time wait in fast timer
</span></span><span class="line"><span class="cl">    22 packets rejects in established connections because of timestamp
</span></span><span class="line"><span class="cl">    51799 delayed acks sent
</span></span><span class="line"><span class="cl">    52 delayed acks further delayed because of locked socket
</span></span><span class="line"><span class="cl">    Quick ack mode was activated 1915 times
</span></span><span class="line"><span class="cl">    187211 packet headers predicted
</span></span><span class="line"><span class="cl">    103280 acknowledgments not containing data payload received
</span></span><span class="line"><span class="cl">    166163 predicted acknowledgments
</span></span><span class="line"><span class="cl">    10144 times recovered from packet loss by selective acknowledgements
</span></span><span class="line"><span class="cl">    Detected reordering 718 times using SACK
</span></span><span class="line"><span class="cl">    Detected reordering 378 times using time stamp
</span></span><span class="line"><span class="cl">    38 congestion windows fully recovered without slow start
</span></span><span class="line"><span class="cl">    378 congestion windows partially recovered using Hoe heuristic
</span></span><span class="line"><span class="cl">    137 congestion windows recovered without slow start by DSACK
</span></span><span class="line"><span class="cl">    109 congestion windows recovered without slow start after partial ack
</span></span><span class="line"><span class="cl">    TCPLostRetransmit: 10031
</span></span><span class="line"><span class="cl">    3 timeouts after SACK recovery
</span></span><span class="line"><span class="cl">    113 timeouts in loss state
</span></span><span class="line"><span class="cl">    36699 fast retransmits
</span></span><span class="line"><span class="cl">    1818 retransmits in slow start
</span></span><span class="line"><span class="cl">    2188 other TCP timeouts
</span></span><span class="line"><span class="cl">    TCPLossProbes: 1841
</span></span><span class="line"><span class="cl">    TCPLossProbeRecovery: 470
</span></span><span class="line"><span class="cl">    244 SACK retransmits failed
</span></span><span class="line"><span class="cl">    2024 DSACKs sent for old packets
</span></span><span class="line"><span class="cl">    72 DSACKs sent for out of order packets
</span></span><span class="line"><span class="cl">    1342 DSACKs received
</span></span><span class="line"><span class="cl">    7 DSACKs for out of order packets received
</span></span><span class="line"><span class="cl">    439 connections reset due to unexpected data
</span></span><span class="line"><span class="cl">    2 connections reset due to early user close
</span></span><span class="line"><span class="cl">    39 connections aborted due to timeout
</span></span><span class="line"><span class="cl">    TCPDSACKIgnoredOld: 17
</span></span><span class="line"><span class="cl">    TCPDSACKIgnoredNoUndo: 608
</span></span><span class="line"><span class="cl">    TCPSackShifted: 1183
</span></span><span class="line"><span class="cl">    TCPSackMerged: 21326
</span></span><span class="line"><span class="cl">    TCPSackShiftFallback: 15706
</span></span><span class="line"><span class="cl">    IPReversePathFilter: 2
</span></span><span class="line"><span class="cl">    TCPRcvCoalesce: 65059
</span></span><span class="line"><span class="cl">    TCPOFOQueue: 5981
</span></span><span class="line"><span class="cl">    TCPOFOMerge: 66
</span></span><span class="line"><span class="cl">    TCPChallengeACK: 5
</span></span><span class="line"><span class="cl">    TCPSYNChallenge: 6
</span></span><span class="line"><span class="cl">    TCPFastOpenActive: 287
</span></span><span class="line"><span class="cl">    TCPFastOpenActiveFail: 48
</span></span><span class="line"><span class="cl">    TCPFastOpenBlackhole: 1
</span></span><span class="line"><span class="cl">    TCPFromZeroWindowAdv: 1
</span></span><span class="line"><span class="cl">    TCPToZeroWindowAdv: 1
</span></span><span class="line"><span class="cl">    TCPWantZeroWindowAdv: 1
</span></span><span class="line"><span class="cl">    TCPSynRetrans: 1660
</span></span><span class="line"><span class="cl">    TCPOrigDataSent: 418755
</span></span><span class="line"><span class="cl">    TCPACKSkippedSynRecv: 9
</span></span><span class="line"><span class="cl">    TCPACKSkippedPAWS: 1
</span></span><span class="line"><span class="cl">    TCPACKSkippedSeq: 1
</span></span><span class="line"><span class="cl">    TCPACKSkippedChallenge: 3
</span></span><span class="line"><span class="cl">    TCPKeepAlive: 238
</span></span><span class="line"><span class="cl">IpExt:
</span></span><span class="line"><span class="cl">    InOctets: 568819056
</span></span><span class="line"><span class="cl">    OutOctets: 523038280
</span></span><span class="line"><span class="cl">    InNoECTPkts: 562312
</span></span><span class="line"><span class="cl">    InECT0Pkts: 419
</span></span><span class="line"><span class="cl">    InCEPkts: 197
</span></span></code></pre></div><p>这些协议栈的统计信息都很直观。ss 只显示已经连接、关闭、孤儿套接字等简要统计，而netstat 则提供的是更详细的网络协议栈信息。比如，上面 netstat 的输出示例，就展示了 TCP 协议的主动连接、被动连接、失败重试、发送和接收的分段数量等各种信息。</p>
<h3 id="网络吞吐和pps">网络吞吐和PPS</h3>
<p>给 sar 增加 -n 参数就可以查看网络的统计信息，比如网络接口（DEV）、网络接口错误（EDEV）、TCP、UDP、ICMP 等等</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@10-7-123-10 ~]# sar -n DEV 1
</span></span><span class="line"><span class="cl">Linux 4.14.129-bbrplus (10-7-123-10)    01/21/2021      _x86_64_        (1 CPU)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">10:26:34 AM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s
</span></span><span class="line"><span class="cl">10:26:35 AM        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00
</span></span><span class="line"><span class="cl">10:26:35 AM      eth0      1.01      1.01      0.05      0.15      0.00      0.00      0.00
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">10:26:35 AM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s
</span></span><span class="line"><span class="cl">10:26:36 AM        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00
</span></span><span class="line"><span class="cl">10:26:36 AM      eth0      8.91     10.89      1.13      2.73      0.00      0.00      0.00
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">10:26:36 AM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s
</span></span><span class="line"><span class="cl">10:26:37 AM        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00
</span></span><span class="line"><span class="cl">10:26:37 AM      eth0      8.08      9.09      1.10      2.28      0.00      0.00      0.00
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">10:26:37 AM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s
</span></span><span class="line"><span class="cl">10:26:38 AM        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00
</span></span><span class="line"><span class="cl">10:26:38 AM      eth0      4.00      6.00      0.41      1.06      0.00      0.00      0.00
</span></span></code></pre></div><ul>
<li>rxpck/s 和 txpck/s 分别是接收和发送的 PPS，单位为包 / 秒。</li>
<li>rxkB/s 和 txkB/s 分别是接收和发送的吞吐量，单位是 KB/ 秒。</li>
<li>rxcmp/s 和 txcmp/s 分别是接收和发送的压缩数据包数，单位是包 / 秒。</li>
<li>%ifutil 是网络接口的使用率，即半双工模式下为 (rxkB/s+txkB/s)/Bandwidth，而全双工模式下为 max(rxkB/s, txkB/s)/Bandwidth</li>
</ul>
<p>其中，Bandwidth 可以用 ethtool 来查询，它的单位通常是 Gb/s 或者 Mb/s，不过注意这里小写字母 b ，表示比特而不是字节。我们通常提到的千兆网卡、万兆网卡等，单位也都是比特。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@testswarm1 ~]# ethtool ens192 | grep Speed
</span></span><span class="line"><span class="cl">        Speed: 10000Mb/s
</span></span></code></pre></div><h3 id="连通性和延时">连通性和延时</h3>
<p>通常使用 ping ，来测试远程主机的连通性和延时，而这基于 ICMP 协议。比如，执行下面的命令，你就可以测试本机到 114.114.114.114 这个 IP 地址的连通性和延时:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@10-7-123-10 ~]#  ping -c3 114.114.114.114
</span></span><span class="line"><span class="cl">PING 114.114.114.114 (114.114.114.114) 56(84) bytes of data.
</span></span><span class="line"><span class="cl">64 bytes from 114.114.114.114: icmp_seq=1 ttl=71 time=39.2 ms
</span></span><span class="line"><span class="cl">64 bytes from 114.114.114.114: icmp_seq=2 ttl=60 time=37.6 ms
</span></span><span class="line"><span class="cl">64 bytes from 114.114.114.114: icmp_seq=3 ttl=71 time=37.5 ms
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">--- 114.114.114.114 ping statistics ---
</span></span><span class="line"><span class="cl">3 packets transmitted, 3 received, 0% packet loss, time 2003ms
</span></span><span class="line"><span class="cl">rtt min/avg/max/mdev = 37.541/38.166/39.259/0.775 ms
</span></span></code></pre></div><p>ping 的输出，可以分为两部分:</p>
<ul>
<li>第一部分，是每个 ICMP 请求的信息，包括 ICMP 序列号（icmp_seq）、TTL（生存时间，或者跳数）以及往返延时。</li>
<li>第二部分，则是三次 ICMP 请求的汇总。</li>
</ul>
<p>上面的示例显示，发送了 3 个网络包，并且接收到 3 个响应，没有丢包发生，这说明测试主机到 114.114.114.114 是连通的；平均往返延时（RTT）是 37.6ms，也就是从发送 ICMP 开始，到接收到 114.114.114.114 回复的确认，总共经历 37.6ms。</p>
<h3 id="io-模型">I/O 模型</h3>
<p>两种 I/O 事件通知方式：水平触发和边缘触发</p>
<ul>
<li>水平触发：只要文件描述符可以非阻塞地执行 I/O ，就会触发通知。也就是说，应用程序可以随时检查文件描述符的状态，然后再根据状态，进行 I/O 操作。</li>
<li>边缘触发：只有在文件描述符的状态发生改变（也就是 I/O 请求达到）时，才发送一次通知。这时候，应用程序需要尽可能多地执行 I/O，直到无法继续读写，才可以停止。如果 I/O 没执行完，或者因为某种原因没来得及处理，那么这次通知也就丢失了。</li>
</ul>
<p>I/O 多路复用方法:</p>
<p><strong>第一种，使用非阻塞 I/O 和水平触发通知，比如使用 select 或者 poll。</strong></p>
<p>根据刚才水平触发的原理，select 和 poll 需要从文件描述符列表中，找出哪些可以执行I/O ，然后进行真正的网络 I/O 读写。由于 I/O 是非阻塞的，一个线程中就可以同时监控一批套接字的文件描述符，这样就达到了单线程处理多请求的目的。所以，这种方式的最大优点，是对应用程序比较友好，它的 API 非常简单。</p>
<p>但是，应用软件使用 select 和 poll 时，需要对这些文件描述符列表进行轮询，这样，请求数多的时候就会比较耗时。并且，select 和 poll 还有一些其他的限制。select 使用固定长度的位相量，表示文件描述符的集合，因此会有最大描述符数量的限制。比如，在 32 位系统中，默认限制是 1024。并且，在 select 内部，检查套接字状态是用轮询的方法，再加上应用软件使用时的轮询，就变成了一个 O(n^2) 的关系。而 poll 改进了 select 的表示方法，换成了一个没有固定长度的数组，这样就没有了最大描述符数量的限制（当然还会受到系统文件描述符限制）。但应用程序在使用 poll 时，同样需要对文件描述符列表进行轮询，这样，处理耗时跟描述符数量就是 O(N) 的关系。</p>
<p>除此之外，应用程序每次调用 select 和 poll 时，还需要把文件描述符的集合，从用户空间传入内核空间，由内核修改后，再传出到用户空间中。这一来一回的内核空间与用户空间切换，也增加了处理成本。</p>
<p><strong>第二种，使用非阻塞 I/O 和边缘触发通知，比如 epoll。</strong></p>
<p>epoll 使用红黑树，在内核中管理文件描述符的集合，这样，就不需要应用程序在每次操作时都传入、传出这个集合。epoll 使用事件驱动的机制，只关注有 I/O 事件发生的文件描述符，不需要轮询扫描整个集合。</p>
<p><strong>第三种，使用异步 I/O（Asynchronous I/O，简称为 AIO）</strong></p>
<p>异步 I/O 允许应用程序同时发起很多 I/O操作，而不用等待这些操作完成。而在 I/O 完成后，系统会用事件通知（比如信号或者回调函数）的方式，告诉应用程序。这时，应用程序才会去查询 I/O 操作的结果。</p>
<p><strong>三种模型区别</strong></p>
<p>第一种，select/poll 水平触发，不需要内核支持，用户态轮询即可完成，再发现有链接状态变动时，需要把数据从内核拷贝到用户态。</p>
<p>第二中， epoll / 边缘触发，需要内核支持，内核在发现链接状态变动时，记录变动内容并存储下来，仍需要用户代码把数据从内核拷贝到用户空间。</p>
<p>第三种， AIO，需要内核支持，内核在发现链接有变动时，根据注册的回调函数，准备好数据，回调函数。内核在回调过程中完成数据从内核到用户空间拷贝，不需要用户代码触发拷贝。</p>
<h3 id="工作模型优化">工作模型优化</h3>
<p><strong>第一种，主进程 + 多个 worker 子进程，这也是最常用的一种模型。</strong></p>
<p>工作模式就是：主进程执行 bind() + listen() 后，创建多个子进程；然后，在每个子进程中，都通过 accept() 或 epoll_wait() ，来处理相同的套接字。</p>
<blockquote>
<p>accept() 和 epoll_wait() 调用，还存在一个惊群的问题。换句话说，当网络I/O 事件发生时，多个进程被同时唤醒，但实际上只有一个进程来响应这个事件，其他被唤醒的进程都会重新休眠。主进程执行 bind() + listen() 后，创建多个子进程；然后，在每个子进程中，都通过 accept() 或 epoll_wait() ，来处理相同的套接字。其中，accept() 的惊群问题，已经在 Linux 2.6 中解决了；而 epoll 的问题，到了 Linux 4.5 ，才通过 EPOLLEXCLUSIVE 解决。</p>
</blockquote>
<p>Nginx使用的就是该模型，为了避免惊群问题， Nginx 在每个 worker 进程中，都增加一个了全局锁（accept_mutex）。这些 worker 进程需要首先竞争到锁，只有竞争到锁的进程，才会加入到 epoll 中，这样就确保只有一个 worker 子进程被唤醒。</p>
<p><strong>第二种，监听到相同端口的多进程模</strong></p>
<p>在这种方式下，所有的进程都监听相同的接口，并且开启 SO_REUSEPORT 选项，由内核负责将请求负载均衡到这些监听进程中去。</p>
<p>该模式下内核确保了只有一个进程被唤醒，就不会出现惊群问题了。不过要注意，想要使用 SO_REUSEPORT 选项，需要用 Linux 3.9 以上的版本才可以。</p>
<p><strong>两种区别</strong></p>
<p>第一种，主进程+多个worker子进程，是子进程在accept和epoll_wait()函数上等待，实在socket建立之后，等待对象是select或epoll函数。</p>
<p>第二种，是在开启SO_REUSEPORT选项后，建立起server socket后，然后在子进程再次绑定该端口监听，内核会根据链接四元组把链接分配到不同子进程上。</p>
<h3 id="域名与-dns-解析">域名与 DNS 解析</h3>
<p>dns服务器配置文件： cat /etc/resolv.conf</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@10-7-123-10 ~]# cat /etc/resolv.conf
</span></span><span class="line"><span class="cl">options timeout:2 attempts:3 single-request-reopen
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">nameserver 10.8.255.1
</span></span><span class="line"><span class="cl">nameserver 10.8.255.2
</span></span><span class="line"><span class="cl">nameserver 114.114.114.114
</span></span></code></pre></div><p>DNS 查询实际上是一个递归过程,其实除了 nslookup，另外一个常用的 DNS 解析工具 dig ，就提供了 trace 功能，可以展示递归查询的整个过程。比如你可以执行下面的命令，得到查询结果：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@10-7-123-10 ~]# dig +trace +nodnssec www.xiaoshuopaihang.pp.ua
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">; &lt;&lt;&gt;&gt; DiG 9.9.4-RedHat-9.9.4-74.el7_6.2 &lt;&lt;&gt;&gt; +trace +nodnssec www.xiaoshuopaihang.pp.ua
</span></span><span class="line"><span class="cl">;; global options: +cmd
</span></span><span class="line"><span class="cl">.                       389     IN      NS      b.root-servers.net.
</span></span><span class="line"><span class="cl">.                       389     IN      NS      k.root-servers.net.
</span></span><span class="line"><span class="cl">.                       389     IN      NS      e.root-servers.net.
</span></span><span class="line"><span class="cl">.                       389     IN      NS      i.root-servers.net.
</span></span><span class="line"><span class="cl">.                       389     IN      NS      c.root-servers.net.
</span></span><span class="line"><span class="cl">.                       389     IN      NS      f.root-servers.net.
</span></span><span class="line"><span class="cl">.                       389     IN      NS      d.root-servers.net.
</span></span><span class="line"><span class="cl">.                       389     IN      NS      a.root-servers.net.
</span></span><span class="line"><span class="cl">.                       389     IN      NS      h.root-servers.net.
</span></span><span class="line"><span class="cl">.                       389     IN      NS      l.root-servers.net.
</span></span><span class="line"><span class="cl">.                       389     IN      NS      g.root-servers.net.
</span></span><span class="line"><span class="cl">.                       389     IN      NS      j.root-servers.net.
</span></span><span class="line"><span class="cl">.                       389     IN      NS      m.root-servers.net.
</span></span><span class="line"><span class="cl">;; Received 239 bytes from 10.8.255.1#53(10.8.255.1) in 513 ms
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ua.                     172800  IN      NS      cd1.ns.ua.
</span></span><span class="line"><span class="cl">ua.                     172800  IN      NS      ho1.ns.ua.
</span></span><span class="line"><span class="cl">ua.                     172800  IN      NS      in1.ns.ua.
</span></span><span class="line"><span class="cl">ua.                     172800  IN      NS      pch.ns.ua.
</span></span><span class="line"><span class="cl">;; Received 305 bytes from 199.7.91.13#53(d.root-servers.net) in 1293 ms
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">pp.ua.                  36000   IN      NS      ns1.uadns.com.
</span></span><span class="line"><span class="cl">pp.ua.                  36000   IN      NS      ns2.uadns.com.
</span></span><span class="line"><span class="cl">pp.ua.                  36000   IN      NS      ns3.uadns.com.
</span></span><span class="line"><span class="cl">;; Received 135 bytes from 74.116.178.9#53(cd1.ns.ua) in 1766 ms
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">xiaoshuopaihang.pp.ua.  600     IN      NS      ns10.uadns.com.
</span></span><span class="line"><span class="cl">xiaoshuopaihang.pp.ua.  600     IN      NS      ns12.uadns.com.
</span></span><span class="line"><span class="cl">xiaoshuopaihang.pp.ua.  600     IN      NS      ns11.uadns.com.
</span></span><span class="line"><span class="cl">;; Received 272 bytes from 178.62.201.147#53(ns1.uadns.com) in 2090 ms
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">www.xiaoshuopaihang.pp.ua. 14400 IN     CNAME   baidu.com.xiaoshuopaihang.pp.ua.
</span></span><span class="line"><span class="cl">xiaoshuopaihang.pp.ua.  14400   IN      SOA     ns10.uadns.com. hostmaster.nic.ua. 2020052206 28800 7200 3600000 86400
</span></span><span class="line"><span class="cl">;; Received 143 bytes from 82.196.1.175#53(ns10.uadns.com) in 195 ms
</span></span></code></pre></div><p><img src="/static/attachment/20210119/linux-net-3.jpg" alt=""></p>
<p>当然，不仅仅是发布到互联网的服务需要域名，很多时候，我们也希望能对局域网内部的主机进行域名解析（即内网域名，大多数情况下为主机名）。Linux 也支持这种行为。所以，你可以把主机名和 IP 地址的映射关系，写入本机的 /etc/hosts 文件中。这样，指定的主机名就可以在本地直接找到目标 IP。</p>
<p>实际上，根据 IP 地址反查域名、根据端口号反查协议名称，是很多网络工具默认的行为，而这往往会导致性能工具的工作缓慢。所以，通常，网络性能工具都会提供一个选项（比如 -n 或者 -nn），来禁止名称解析。</p>
<h3 id="tcp-防ddos">TCP 防DDOS</h3>
<p>注意，开启 TCP syncookies 后，内核选项net.ipv4.tcp_max_syn_backlog 也就无效了。</p>
<p>可以通过下面的命令，开启 TCP SYN Cookies：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@testswarm1 ~]# sysctl -w net.ipv4.tcp_syncookies=1
</span></span><span class="line"><span class="cl">net.ipv4.tcp_syncookies = 1
</span></span></code></pre></div><p>注意，上述 sysctl 命令修改的配置都是临时的，重启后这些配置就会丢失。所以，为了保证配置持久化，你还应该把这些配置，写入 /etc/sysctl.conf 文件中。比如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ cat /etc/sysctl.conf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">net.ipv4.tcp_syncookies = 1
</span></span><span class="line"><span class="cl">net.ipv4.tcp_synack_retries = 1
</span></span><span class="line"><span class="cl">net.ipv4.tcp_max_syn_backlog = 1024
</span></span></code></pre></div><p>写入 /etc/sysctl.conf 的配置，需要执行 sysctl -p 命令后，才会动态生效。</p>
<p><img src="/static/attachment/20210119/linux-net-4.jpg" alt=""></p>
<p><img src="/static/attachment/20210119/linux-net-5.jpg" alt=""></p>
<p><img src="/static/attachment/20210119/linux-net-6.jpg" alt=""></p>


        
          <div class="blog-tags">
            
              <a href="https://hzren.github.io/blog//tags/linux/">Linux</a>&nbsp;
            
              <a href="https://hzren.github.io/blog//tags/network/">Network</a>&nbsp;
            
          </div>
        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
        <a href="//twitter.com/share?url=https%3a%2f%2fhzren.github.io%2fblog%2fblog%2f2021-01-19-linux%25E7%25BD%2591%25E7%25BB%259C%2f&amp;text=Linux%e7%bd%91%e7%bb%9c&amp;via=username" target="_blank" title="Share on Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fhzren.github.io%2fblog%2fblog%2f2021-01-19-linux%25E7%25BD%2591%25E7%25BB%259C%2f" target="_blank" title="Share on Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//reddit.com/submit?url=https%3a%2f%2fhzren.github.io%2fblog%2fblog%2f2021-01-19-linux%25E7%25BD%2591%25E7%25BB%259C%2f&amp;title=Linux%e7%bd%91%e7%bb%9c" target="_blank" title="Share on Reddit">
          <i class="fab fa-reddit"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fhzren.github.io%2fblog%2fblog%2f2021-01-19-linux%25E7%25BD%2591%25E7%25BB%259C%2f&amp;title=Linux%e7%bd%91%e7%bb%9c" target="_blank" title="Share on LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fhzren.github.io%2fblog%2fblog%2f2021-01-19-linux%25E7%25BD%2591%25E7%25BB%259C%2f&amp;title=Linux%e7%bd%91%e7%bb%9c" target="_blank" title="Share on StumbleUpon">
          <i class="fab fa-stumbleupon"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fhzren.github.io%2fblog%2fblog%2f2021-01-19-linux%25E7%25BD%2591%25E7%25BB%259C%2f&amp;description=Linux%e7%bd%91%e7%bb%9c" target="_blank" title="Share on Pinterest">
          <i class="fab fa-pinterest"></i>
        </a>
      </li>
    </ul>
  </div>
  

              </div>
            </section>
        

        
          
            
          

          
                  <h4 class="see-also">也可以看看</h4>
                  <ul>
                
                
                    <li><a href="/blog/blog/2021-01-15-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">文件系统</a></li>
                
                    <li><a href="/blog/blog/2021-01-15-linux%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/">Linux内存管理</a></li>
                
                    <li><a href="/blog/blog/2021-01-15-%E4%B8%AD%E6%96%AD/">中断</a></li>
                
                    <li><a href="/blog/blog/2021-01-14-%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2/">上下文切换</a></li>
                
                    <li><a href="/blog/blog/2021-01-13-%E8%B7%AF%E7%94%B1%E6%9D%A1%E7%9B%AE/">路由条目</a></li>
                
              </ul>

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://hzren.github.io/blog/blog/2021-01-15-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" data-toggle="tooltip" data-placement="top" title="文件系统">&larr; 前一篇</a>
            </li>
          
          
            <li class="next">
              <a href="https://hzren.github.io/blog/blog/2021-01-22-java%E8%AF%AD%E8%A8%80/" data-toggle="tooltip" data-placement="top" title="Java语言">后一篇 &rarr;</a>
            </li>
          
        </ul>
      


      
        
        
      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
		
		  <a href="mailto:hzren@outlook.com" title="Email me">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://www.facebook.com/username" title="Facebook">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-facebook fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://github.com/username" title="GitHub">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://gitlab.com/username" title="GitLab">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-gitlab fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://bitbucket.org/username" title="Bitbucket">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-bitbucket fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://twitter.com/username" title="Twitter">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://username.slack.com/" title="Slack">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-slack fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://reddit.com/u/username" title="Reddit">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-reddit-alien fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://linkedin.com/in/username" title="LinkedIn">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://www.xing.com/profile/username" title="Xing">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-xing fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://stackoverflow.com/users/XXXXXXX/username" title="StackOverflow">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://www.snapchat.com/add/username" title="Snapchat">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-snapchat-ghost fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://www.instagram.com/username" title="Instagram">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-instagram fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://www.youtube.com/user/username" title="Youtube">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-youtube fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://soundcloud.com/username" title="SoundCloud">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-soundcloud fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://open.spotify.com/user/username" title="Spotify">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-spotify fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://username.bandcamp.com/" title="Bandcamp">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-bandcamp fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://itch.io/profile/username" title="Itch.io">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-gamepad fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://vk.com/username" title="VK">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-vk fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://paypal.me/username" title="PayPal">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-paypal fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://telegram.me/username" title="Telegram">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-telegram fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://500px.com/username" title="500px">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-500px fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://codepen.io/username" title="CodePen">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-codepen fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://www.kaggle.com/username" title="kaggle">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-kaggle fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a rel="me"href="https://url" title="Mastodon">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-mastodon fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://weibo.com/username" title="Weibo">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-weibo fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://discord.gg/invite%20code%20%28https://discord.gg/XXXXXXX%29" title="Discord">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-discord fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://www.strava.com/athletes/userid" title="Strava">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-strava fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="https://hzren.github.io/blog/">renhongzhen</a>
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2022
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://hzren.github.io/blog/">Code Mark</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          由 <a href="https://gohugo.io">Hugo v0.109.0</a> 强力驱动 &nbsp;&bull;&nbsp; 主题 <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> 移植自 <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://hzren.github.io/blog/js/main.js"></script>
<script src="https://hzren.github.io/blog/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://hzren.github.io/blog/js/load-photoswipe.js"></script>









    
  </body>
</html>

